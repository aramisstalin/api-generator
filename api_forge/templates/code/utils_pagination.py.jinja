"""
Pagination utilities.

Provides standardized pagination for list endpoints.
"""

from typing import Optional
from fastapi import Query
from pydantic import BaseModel, Field, field_validator


class PaginationParams(BaseModel):
    """
    Pagination parameters for list endpoints.

    Attributes:
        page: Page number (1-indexed)
        page_size: Items per page
    """
    page: int = Field(Query(1, ge=1, description="Page number (1-indexed)"))
    page_size: int = Field(
        Query(20, ge=1, le=100, description="Items per page (max 100)")
    )

    @field_validator("page")
    @classmethod
    def validate_page(cls, v):
        if v < 1:
            raise ValueError("Page must be >= 1")
        return v

    @field_validator("page_size")
    @classmethod
    def validate_page_size(cls, v):
        if v < 1:
            raise ValueError("Page size must be >= 1")
        if v > 100:
            raise ValueError("Page size must be <= 100")
        return v

    @property
    def skip(self) -> int:
        """Calculate number of records to skip"""
        return (self.page - 1) * self.page_size

    @property
    def limit(self) -> int:
        """Get limit value (same as page_size)"""
        return self.page_size


def calculate_total_pages(total: int, page_size: int) -> int:
    """
    Calculate total number of pages.

    Args:
        total: Total number of items
        page_size: Items per page

    Returns:
        Total number of pages
    """
    if page_size <= 0:
        return 0
    return (total + page_size - 1) // page_size